---
import '../styles/global.css';
import Icon from '../components/Icon.astro';

interface Props {
  title: string;
  description?: string;
}

const { title, description = 'Sistema de E-commerce con PostgreSQL' } = Astro.props;

const currentPath = Astro.url.pathname;

const navItems = [
  { href: '/', label: 'Dashboard', icon: 'home' },
  { href: '/productos', label: 'Productos', icon: 'shopping-bag' },
  { href: '/categorias', label: 'Categorías', icon: 'tag' },
  { href: '/stock', label: 'Inventario', icon: 'cube' },
  { href: '/clientes', label: 'Clientes', icon: 'users' },
  { href: '/pedidos', label: 'Pedidos', icon: 'rectangle-stack' },
  { href: '/pagos', label: 'Pagos', icon: 'credit-card' },
  { href: '/envios', label: 'Envíos', icon: 'truck' },
  { href: '/cupones', label: 'Cupones', icon: 'ticket' },
  { href: '/devoluciones', label: 'Devoluciones', icon: 'arrow-path' },
];
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content={description}>
  <title>{title} | E-commerce BS2</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <script src="https:
</head>
<body>
  <div class="flex h-screen overflow-hidden">

    <aside id="sidebar" class="w-64 shrink-0 border-r transition-all duration-300 ease-in-out overflow-y-auto"
           style="background-color: var(--bg-secondary); border-color: var(--border-primary);">

      <div class="h-16 flex items-center justify-between px-6 border-b" style="border-color: var(--border-primary);">
        <a href="/" class="flex items-center space-x-3 group">
          <div class="w-8 h-8 rounded-lg flex items-center justify-center transition-all"
               style="background-color: var(--accent-blue);">
            <Icon name="shopping-bag" class="text-white" size={20} />
          </div>
          <span class="text-lg font-bold" style="color: var(--text-primary);">E-commerce</span>
        </a>
        <button id="sidebarToggle" class="lg:hidden p-1 rounded-md hover:bg-opacity-10"
                style="color: var(--text-secondary);">
          <Icon name="x-mark" size={20} />
        </button>
      </div>

      <nav class="p-4 space-y-1">
        {navItems.map(item => {
          const isActive = currentPath === item.href ||
                          (item.href !== '/' && currentPath.startsWith(item.href));
          return (
            <a
              href={item.href}
              class={`flex items-center space-x-3 px-4 py-3 rounded-lg transition-all duration-200 group ${
                isActive ? 'nav-item-active' : 'nav-item'
              }`}
            >
              <Icon
                name={item.icon}
                size={20}
                class={isActive ? 'text-white' : 'group-hover:scale-110 transition-transform'}
              />
              <span class="font-medium">{item.label}</span>
            </a>
          );
        })}
      </nav>

      <div class="absolute bottom-0 left-0 right-0 p-4 border-t" style="border-color: var(--border-primary);">
        <div class="flex items-center space-x-3 px-4 py-3 rounded-lg" style="background-color: var(--bg-tertiary);">
          <div class="w-8 h-8 rounded-full flex items-center justify-center" style="background-color: var(--accent-purple);">
            <span class="text-white text-sm font-bold">BS</span>
          </div>
          <div class="flex-1">
            <p class="text-sm font-medium" style="color: var(--text-primary);">Base de Datos 2</p>
            <p class="text-xs" style="color: var(--text-secondary);">Universidad 2025</p>
          </div>
        </div>
      </div>
    </aside>

    <div class="flex-1 flex flex-col overflow-hidden">

      <header class="h-16 border-b flex items-center justify-between px-6"
              style="background-color: var(--bg-secondary); border-color: var(--border-primary);">
        <div class="flex items-center space-x-4">
          <button id="sidebarToggleMobile" class="lg:hidden p-2 rounded-lg hover:bg-opacity-10"
                  style="color: var(--text-primary); background-color: var(--bg-tertiary);">
            <Icon name="bars-3" size={24} />
          </button>
          <h1 class="text-xl font-bold" style="color: var(--text-primary);">{title}</h1>
        </div>

        <div class="flex items-center space-x-4">
          <div class="text-right hidden sm:block">
            <p class="text-sm font-medium" style="color: var(--text-primary);">Sistema E-commerce</p>
            <p class="text-xs" style="color: var(--text-secondary);">PostgreSQL + Astro</p>
          </div>
        </div>
      </header>

      <main class="flex-1 overflow-y-auto p-6" style="background-color: var(--bg-primary);">
        <div class="max-w-7xl mx-auto">
          <slot />
        </div>
      </main>
    </div>
  </div>

  <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden"></div>

  <style>
    .nav-item {
      color: var(--text-secondary);
    }

    .nav-item:hover {
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .nav-item-active {
      background-color: var(--accent-blue);
      color: white;
    }

    .nav-item-active:hover {
      background-color: var(--accent-blue-hover);
    }

    @media (max-width: 1024px) {
      #sidebar {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        z-index: 50;
        transform: translateX(-100%);
      }

      #sidebar.active {
        transform: translateX(0);
      }
    }
  </style>

  <script is:inline>
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebarOverlay');
    const toggleBtn = document.getElementById('sidebarToggleMobile');
    const closeBtn = document.getElementById('sidebarToggle');

    function toggleSidebar() {
      sidebar?.classList.toggle('active');
      overlay?.classList.toggle('hidden');
    }

    toggleBtn?.addEventListener('click', toggleSidebar);
    closeBtn?.addEventListener('click', toggleSidebar);
    overlay?.addEventListener('click', toggleSidebar);

    if (window.innerWidth < 1024) {
      document.querySelectorAll('#sidebar a').forEach(link => {
        link.addEventListener('click', () => {
          sidebar?.classList.remove('active');
          overlay?.classList.add('hidden');
        });
      });
    }
  </script>
</body>
</html>
